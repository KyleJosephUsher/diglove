{% extends 'base.html' %}
{% block title %}Video Chat - Dig Love{% endblock %}

{% block content %}
<div class="container mt-4">
  <h2 class="mb-4 text-center">Video Chat with {{ target_user.username }}</h2>

  <div class="row">
    <div class="col-md-6 mb-3">
      <h5 class="text-center">You ({{ current_user.username }})</h5>
      <video id="localVideo" autoplay playsinline muted class="w-100 border rounded"></video>
    </div>
    <div class="col-md-6 mb-3">
      <h5 class="text-center">{{ target_user.username }}</h5>
      <video id="remoteVideo" autoplay playsinline class="w-100 border rounded"></video>
    </div>
  </div>

  <div class="d-flex justify-content-center gap-3 mt-4 flex-wrap">
    <button id="startCallBtn" class="btn btn-success">Start Call</button>
    <button id="hangupBtn" class="btn btn-danger" disabled>Hang Up</button>
    <button id="toggleVideoBtn" class="btn btn-outline-secondary">🎥 Turn Off Camera</button>
    <button id="toggleAudioBtn" class="btn btn-outline-secondary">🎙️ Mute</button>
    <button id="shareScreenBtn" class="btn btn-outline-info">📺 Share Screen</button>
  </div>

  <!-- Ringtone -->
  <audio id="ringtone" src="{{ url_for('static', filename='audio/ringtone.mp3') }}" preload="auto"></audio>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.socket.io/4.7.1/socket.io.min.js"></script>

<!-- Pass room to JS -->
<script>
  const ROOM_ID = "{{ room_id }}";
</script>

<!-- External JS -->
<script src="{{ url_for('static', filename='js/videochat.js') }}"></script>
{% endblock %}